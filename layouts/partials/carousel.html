{{- $pages := first 3 (where $.Site.Pages "Params.carousel" true) -}}
{{- if and .IsHome $pages (eq .Paginator.PageNumber 1) -}}
<div class="container p-0 mb-4">
    <div class="row p-0 m-0">
        <div id="carouselHome" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators justify-content-sm-center justify-content-lg-start mb-0 mx-auto ps-0 ps-lg-3">
            {{- $i := 0 -}}
            {{- range $pages -}}
                <button type="button" data-bs-target="#carouselHome" data-bs-slide-to="{{ $i }}" aria-label="{{ .Title }}"
                {{ if eq $i 0 }}class="rounded-circle active" aria-current="true"{{ else }}class="rounded-circle"{{ end }}></button>
                {{- $i = add $i 1 -}}
            {{- end -}}
            </div>
            <div class="carousel-inner">
            {{- $i := 0 -}}
            {{- range $pages -}}
                <a class="carousel-item{{ if eq $i 0 }} active{{ end }}" href="{{ .Permalink }}">
                    {{- template "carousel-thumbnail" . -}}
                    <div class="carousel-caption ps-3 text-center text-lg-start bottom-0 start-0 end-0 mb-2">
                        <h5>{{ .Title }}</h5>
                        <div class="d-none d-lg-flex">{{ .Summary }}</div>
                    </div>
                </a>
                {{- $i = add $i 1 -}}
            {{- end -}}
            </div>
            <div class="carousel-controls position-absolute d-none d-lg-block">
                <button class="btn btn-sm btn-outline-secondary p-1" type="button" data-bs-target="#carouselHome" data-bs-slide="prev">
                    <span class="fas fa-chevron-down fa-2x" data-fa-transform="rotate-90" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="btn btn-sm btn-outline-secondary p-1 ms-2" type="button" data-bs-target="#carouselHome" data-bs-slide="next">
                    <span class="fas fa-chevron-down fa-2x" data-fa-transform="rotate-270" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>
</div>
{{- end -}}

{{- define "carousel-thumbnail" -}}
{{- $smallImageURL := "/images/none.png" -}}
{{- $largeImageURL := "/images/none.png" -}}
{{- $featured := false -}}
{{ if .Params.images }}
    {{ $smallImageURL = index .Params.images 0 | absURL }}
    {{ $largeImageURL = $smallImageURL }}
{{- else -}}
  {{- $images := .Resources.ByType "image" -}}
  {{- $featured = $images.GetMatch "*feature*" -}}
  {{- if not $featured }}{{ $featured = $images.GetMatch "{*cover*,*thumbnail*}" }}{{ end -}}
  {{- with $featured -}}
    {{- $smallImage := $featured.Resize "x180" -}}
    {{- $smallImageURL = $smallImage.Permalink -}}
    {{- $largeImage := $featured.Resize "x420" -}}
    {{- $largeImageURL = $largeImage.Permalink -}}
  {{- end -}}
{{- end -}}
<picture>
  <source srcset="{{ $smallImageURL }}" media="(max-width: 576px)">
  <img class="d-block w-100" alt="{{ .Title }}" src="{{ $largeImageURL }}" loading="lazy"
    {{ with $featured }} data-src="{{ .Permalink }}"{{ end }}/>
</picture>
{{- end -}}
