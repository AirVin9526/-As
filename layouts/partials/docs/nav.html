<aside class="docs-nav col-lg-2" tabindex="-1" data-bs-hide="focusout">
  <div class="offcanvas-lg offcanvas-start" id="offcanvasDocsNav" aria-labelledby="offcanvasDocsNavLabel">
    <div class="offcanvas-header border-bottom">
      <h5 class="offcanvas-title" id="offcanvasDocsNavLabel">Browse docs</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#offcanvasDocsNav"></button>
    </div>
    <div class="offcanvas-body pt-2">
      {{ template "walk-nav" (dict "section" .FirstSection "page" .) }}
    </div>
  </div>
</aside>

{{- define "walk-nav" -}}
{{- $section := .section -}}
{{- $page := .page -}}
<ul class="list-unstyled mb-2 w-100{{ if eq $section $page.FirstSection }} pe-3{{ end }}">
{{- $expand := default false .page.Site.Params.docs.nav.expand -}}
    {{- range ($section.Pages.GroupBy "Weight" "desc") -}}
      {{- range sort .Pages "Title" -}}
        {{- if .IsSection -}}
        {{- $sectionId := printf "nav-%s" .File.UniqueID -}}
        {{- $active := false -}}
        {{- if hasPrefix $page.Permalink .Permalink -}}
          {{- $active = true -}}
        {{- end -}}
        <li class="mb-2" tabindex="-1">
          <div class="py-1 d-flex justify-content-between align-items-center ps-2{{ if $active }} text-primary{{ end }}">
            <a href="{{ .Permalink }}">{{- template "nav-title" . -}}</a>
            <a class="btn-toggle ms-1{{ if and (not $active) (not $expand) }} collapsed{{ end }}" role="button" data-bs-toggle="collapse"
              data-bs-target="#{{ $sectionId }}" aria-expanded="{{ if or $active $expand }}true{{ else }}false{{ end }}" aria-controls="{{ $sectionId }}">
              <i class="btn-toggle-icon fas fa-chevron-circle-down ms-auto" data-fa-transform="rotate-270"></i>
            </a>
          </div>
          <div class=" mt-2 border-start collapse {{ if or $active $expand}} show{{ end }}{{ if $active }} border-primary{{ end }}" id="{{ $sectionId }}">
            <ul class="btn-toggle-nav list-unstyled fw-normal ms-2">
              {{ template "walk-nav" (dict "section" . "page" $page) }}
            </ul>
          </div>
        </li>
        {{- else -}}
        <li class="mb-2 py-1 ps-2{{ if eq .Permalink $page.Permalink }} text-primary{{ end }}" tabindex="-1">
          <a href="{{ .Permalink }}"{{ if .Params.redirect }} target="_blank"{{ end }}>
            {{- template "nav-title" . -}}
            {{- if .Params.redirect -}}
              <i class="ms-1 fas fa-external-link-square-alt"></i>
            {{- end -}}
          </a>
        </li>
        {{- end -}}
      {{- end -}}
    {{- end -}}
</ul>
{{- end -}}

{{- define "nav-title" -}}
  {{- with .Params.linkTitleIcon -}}
    {{- . | safeHTML -}}
  {{- end -}}
  {{- .LinkTitle -}}
{{- end -}}
